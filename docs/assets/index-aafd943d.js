var L=Object.defineProperty;var w=(r,t,e)=>t in r?L(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var h=(r,t,e)=>(w(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const M={listTag:"ul",listSelector:"ul",itemSelector:"li",handleSelector:".phl-handle",listClass:["phl-list"],activeClass:["phl-active"],dragClass:["phl-drag"],threshold:20,context:0,expandBtn:".phl-expand",collapseBtn:".phl-collapse",extractBtn:".phl-extract"},f=new Map;class C{constructor(t){h(this,"dragEl");h(this,"activeEl");h(this,"overEl");h(this,"from");h(this,"to");h(this,"lastMouseY");h(this,"lastStepX");h(this,"lastMove");h(this,"instances",[]);h(this,"movedFrom");this.lastMouseY=0,this.lastStepX=0,this.lastMove=0,this.instances.push(t)}register(t){this.instances.push(t)}dispatch(t){if(this.activeEl)for(let e=0;e<this.instances.length;e++){const i=this.instances[e];if(!i.getElement().contains(this.activeEl))continue;const s=i.events.get(t);if(!s)return;s.forEach(o=>{o.call(i,{item:this.activeEl,from:this.from,to:this.to})});return}}}class p{constructor(t,e){h(this,"ctx");h(this,"element");h(this,"opts");h(this,"events",new Map);h(this,"hasTouch","ontouchstart"in window||navigator.maxTouchPoints);h(this,"onMouseMoveFn");h(this,"onTouchMoveFn");h(this,"cleanUpEvt");if(typeof t=="string"){if(this.element=l(t),!this.element)throw new Error("Provided element does not exist!")}else this.element=t;if(typeof this.element.__hierarchy_list_saad>"u")this.element.__hierarchy_list_saad=!0;else throw new Error("Trying to create multiple HierarchyList in one element!");this.opts={...M,...e||{}},["string","number"].indexOf(typeof this.opts.context)===-1&&(this.opts.context="_saad_");let i=f.get(this.opts.context);i?i.register(this):(i=new C(this),f.set(this.opts.context,i)),this.ctx=i,this.opts.listSelector||(this.opts.listSelector=this.opts.listTag),["listClass","activeClass","dragClass"].forEach(s=>{typeof this.opts[s]=="string"&&(this.opts[s]=this.opts[s].split(" "))}),this.init()}static make(t,e){return new p(t,e)}init(){this.onMouseMoveFn=t=>{this.onDrag(t)},this.onTouchMoveFn=t=>{this.onTouchMove(t)},this.cleanUpEvt=()=>{var t;if((t=this.ctx.dragEl)==null||t.remove(),this.ctx.activeEl){b(this.ctx.activeEl,this.opts.activeClass);try{this.ctx.dispatch("release")}catch(e){console.error(e)}}document.body.classList.remove("phl-moving"),this.ctx.dragEl=void 0,this.ctx.activeEl=void 0,this.ctx.overEl=void 0,this.ctx.from=null,this.ctx.to=null,document.removeEventListener("mousemove",this.onMouseMoveFn),document.removeEventListener("mouseup",this.cleanUpEvt),document.removeEventListener("touchmove",this.onTouchMoveFn),document.removeEventListener("touchend",this.cleanUpEvt)},O(this.opts.handleSelector,this.element).forEach(t=>{this.initHandle(t)}),this.element.addEventListener("mouseenter",()=>{if(!this.ctx.activeEl)return;if(this.element.matches(this.opts.listSelector))this.element.appendChild(this.ctx.activeEl);else{const e=l(this.opts.listSelector,this.element);e&&this.moveTo(e)}if(this.ctx.movedFrom){const e=this.ctx.movedFrom.events.get("moveout");e&&e.forEach(i=>{i.call(this.ctx.movedFrom,{item:this.ctx.activeEl})}),this.ctx.movedFrom=void 0}const t=this.events.get("movein");t&&t.forEach(e=>{e.call(this,{item:this.ctx.activeEl})})}),this.element.addEventListener("mouseleave",()=>{this.ctx.activeEl&&(this.ctx.movedFrom=this)})}initHandle(t){const e=s=>{if(s.cancelable)s.preventDefault();else return;s.stopPropagation(),this.ctx.dragEl=i.cloneNode(!0),m(this.ctx.dragEl,this.opts.dragClass),document.body.appendChild(this.ctx.dragEl),this.ctx.dragEl.style.position="fixed",this.ctx.dragEl.style.pointerEvents="none",document.body.classList.add("phl-moving"),this.ctx.activeEl=i,m(this.ctx.activeEl,this.opts.activeClass),document.addEventListener("mousemove",this.onMouseMoveFn),document.addEventListener("mouseup",this.cleanUpEvt),this.hasTouch&&(document.addEventListener("touchmove",this.onTouchMoveFn),document.addEventListener("touchend",this.cleanUpEvt));let o,n;"x"in s&&"y"in s?(o=s.x,n=s.y):(o=s.touches[0].clientX,n=s.touches[0].clientY),this.ctx.lastMouseY=n,this.ctx.lastStepX=o,this.ctx.dragEl.style.left=o+"px",this.ctx.dragEl.style.top=n+"px",this.ctx.from=this.ctx.activeEl.parentElement,this.ctx.to=null,this.ctx.dispatch("start")},i=t.closest(this.opts.itemSelector);i&&(t.addEventListener("mousedown",e),this.hasTouch&&t.addEventListener("touchstart",s=>{s.touches.length===1&&e(s)}),i.addEventListener("mouseenter",()=>this.onOver(i)),this.btnEvts(i))}btnEvts(t){const e=l(this.opts.expandBtn,t),i=l(this.opts.collapseBtn,t),s=l(this.opts.extractBtn,t),o=l(this.opts.listSelector,t),n=o?getComputedStyle(o):{};e&&(n.display==="none"?e.style.display="":e.style.display="none",e.addEventListener("click",()=>{this.expand(e.closest(this.opts.itemSelector))})),i&&(n.display==="none"||!o?i.style.display="none":i.style.display="",i.addEventListener("click",()=>{this.collapse(i.closest(this.opts.itemSelector))})),s&&(!o||o.children.length===0?(o==null||o.remove(),s.style.display="none"):s.style.display="",s.addEventListener("click",()=>{this.extract(s.closest(this.opts.itemSelector))}))}onOver(t){if(this.ctx.activeEl){if(this.ctx.activeEl.contains(t)){this.ctx.overEl=void 0;return}this.ctx.overEl=t}}onTouchMove(t){const e=t.touches[0],i=document.elementFromPoint(e.clientX,e.clientY),s=i==null?void 0:i.closest(this.opts.itemSelector);s&&this.element.contains(s)&&this.onOver(s),this.onDrag({x:e.clientX,y:e.clientY})}onDrag(t){const e=this.ctx.dragEl;if(e.style.left=t.x+"px",e.style.top=t.y+"px",Date.now()-this.ctx.lastMove<100)return;this.ctx.lastMove=Date.now();const i=this.ctx.lastMouseY;this.ctx.lastMouseY=t.y;const s=this.ctx.lastStepX;if(t.x-s>this.opts.threshold)this.toRight(),this.ctx.lastStepX=t.x;else if(s-t.x>this.opts.threshold){this.toLeft(),this.ctx.lastStepX=t.x;return}const o=this.ctx.overEl;if(!o)return;const n=o.getBoundingClientRect();i<t.y?t.y>n.top&&this.moveTo(o.parentElement,o.nextElementSibling):t.y<n.top+n.height&&this.moveTo(o.parentElement,o)}toRight(){var o;const t=this.ctx.activeEl,e=(o=this.ctx.activeEl)==null?void 0:o.previousElementSibling;if(!t||!e)return;let i=l(this.opts.listSelector,e);i||(i=document.createElement(this.opts.listTag),m(i,this.opts.listClass),e.appendChild(i)),this.moveTo(i),this.expand(e);const s=l(this.opts.extractBtn,e);s&&(s.style.display=""),this.ctx.dispatch("rightmove")}toLeft(){var i;const t=(i=this.ctx.activeEl)==null?void 0:i.parentElement,e=t==null?void 0:t.closest(this.opts.itemSelector);e&&(this.moveTo(e.parentElement,e.nextElementSibling),this.ctx.dispatch("leftmove"))}moveTo(t,e=null){var o;if(!this.ctx.activeEl)return;const i=(o=this.ctx.activeEl)==null?void 0:o.closest(this.opts.listSelector),s=i==null?void 0:i.closest(this.opts.itemSelector);this.ctx.from=this.ctx.activeEl.parentElement,this.ctx.to=t,this.ctx.dispatch("beforemove"),t.insertBefore(this.ctx.activeEl,e),i&&i.children.length===0&&(i.remove(),s&&this.showOrHideActions(s)),this.ctx.dispatch("aftermove")}expand(t){const e=l(this.opts.expandBtn,t),i=l(this.opts.collapseBtn,t);e&&(e.style.display="none");const s=l(this.opts.listSelector,t);s&&(s.style.display="",i&&(i.style.display=""))}collapse(t){const e=l(this.opts.expandBtn,t),i=l(this.opts.collapseBtn,t);i&&(i.style.display="none");const s=l(this.opts.listSelector,t);s&&(s.style.display="none",e&&(e.style.display=""))}extract(t){const e=l(this.opts.listSelector,t),i=t.parentElement;if(!e||!i){this.showOrHideActions(t);return}this.ctx.from=e,this.ctx.to=i;const s=t.nextElementSibling;for(;e.children.length;)i.insertBefore(e.children[0],s);e.remove(),this.showOrHideActions(t),this.ctx.dispatch("extract"),this.ctx.from=null,this.ctx.to=null}showOrHideActions(t){const e=l(this.opts.extractBtn,t),i=l(this.opts.expandBtn,t),s=l(this.opts.collapseBtn,t),o=l(this.opts.listSelector,t);i&&(i.style.display=o&&o.style.display==="none"?"":"none"),s&&(s.style.display=o&&o.style.display!=="none"?"":"none"),e&&(e.style.display=o?"":"none")}on(t,e){return typeof t=="string"&&(t=[t]),t.forEach(i=>{if(i==="change"){this.on(["release","moveout","extract","movein"],e);return}let s=this.events.get(i);s||(s=[],this.events.set(i,s)),s.indexOf(e)===-1&&s.push(e)}),this}serialize(t){return p.serialize(this.element,this.opts.listSelector,t)}serializeTree(t){return p.serializeTree(this.element,this.opts.listSelector,t)}static serialize(t,e="ul,ol",i){if(t&&!t.matches(e)&&(t=l(e,t)),!t)throw new Error("No element is given to serialize!");const s=[];return this._serializeFlat(t,-1,s,e,i),s}static _serializeFlat(t,e,i,s,o){for(let n=0;n<t.children.length;n++){const d=t.children[n],c={data:o?o(d):d.dataset,parent:e};i.push(c);const a=l(s,d);a&&this._serializeFlat(a,i.length-1,i,s,o)}}static serializeTree(t,e="ol,ul",i){if(t&&!t.matches(e)&&(t=l(e,t)),!t)throw new Error("No element is given to serialize!");const s=[];return this._serializeTree(t,s,e,i),s}static _serializeTree(t,e,i,s){for(let o=0;o<t.children.length;o++){const n=t.children[o],d=[],c=l("ul,li",n);c&&this._serializeTree(c,d,i,s),e.push({data:s?s(n):n.dataset,children:d})}}getElement(){return this.element}addItem(t,{before:e,after:i,inside:s}={}){var d;if(!t.matches(this.opts.itemSelector)){console.error(`[HierarchyList] provided item does not match: ${this.opts.itemSelector}`);return}let o=t;if(o.matches(this.opts.handleSelector)||(o=l(this.opts.handleSelector,t)),!o){console.error(`[HierarchyList] provided item does not have any handle: '${this.opts.handleSelector}'`);return}if(this.initHandle(o),typeof e=="string"&&(e=l(e,this.element)),e){const c=e.closest(this.opts.listSelector);c==null||c.insertBefore(t,e.closest(this.opts.itemSelector));const a=c==null?void 0:c.closest(this.opts.itemSelector);a&&this.showOrHideActions(a);return}if(typeof i=="string"&&(i=l(i,this.element)),i){const c=i.closest(this.opts.listSelector);c==null||c.insertBefore(t,(d=i.closest(this.opts.itemSelector))==null?void 0:d.nextElementSibling);const a=c==null?void 0:c.closest(this.opts.itemSelector);a&&this.showOrHideActions(a);return}if(typeof s=="string"&&(s=l(s,this.element)),s){if(s.matches(this.opts.listSelector)){s.appendChild(t);return}let c=l(this.opts.listSelector,s);c||(c=document.createElement(this.opts.listTag),m(c,this.opts.listClass),s.appendChild(c)),c.appendChild(t),this.expand(c);const a=c==null?void 0:c.closest(this.opts.itemSelector);a&&this.showOrHideActions(a);return}let n=this.element;n.matches(this.opts.listSelector)||(n=l(this.opts.listSelector,n)),n&&n.appendChild(t)}}function l(r,t){return(t||document).querySelector(r)}function O(r,t){return(t||document).querySelectorAll(r)}function b(r,t){t.forEach(e=>r.classList.remove(e))}function m(r,t){t.forEach(e=>r.classList.add(e))}function y(r,t={}){const e=document.createElement("li");e.className="phl-item",e.innerHTML=`
    <div class="phl-label-group">
        <button type="button" class="phl-handle"></button>
        <div class="phl-label">${r}</div>
        <button type="button" class="phl-extract"></button>
        <button type="button" class="phl-collapse"></button>
        <button type="button" class="phl-expand"></button>
    </div>
    `;for(let i in t)e.dataset[i]=t[i];return e}window&&typeof window.HierarchyList>"u"&&(window.HierarchyList=p);const E=document.querySelector("#app1"),F=document.querySelector("#flat-1"),B=document.querySelector("#tree-1"),g=document.querySelector("#app2"),H=document.querySelector("#flat-2"),z=document.querySelector("#tree-2");let u=0;for(let r=0;r<10;r++){u=r+1;const t=y(`Item ${u}`,{index:u.toString()});E.appendChild(t),g.appendChild(t.cloneNode(!0))}const S=p.make(E).on("change",T);T.call(S);x.call(p.make(g).on("change",x));function T(){F.innerHTML=JSON.stringify(this.serialize(r=>{var e;const t={...r.dataset};return t.label=(e=r.querySelector(".phl-label"))==null?void 0:e.innerHTML,t}),null,2),B.innerHTML=JSON.stringify(this.serializeTree(),null,2),console.log("Fired 1")}function x(){H.innerHTML=JSON.stringify(this.serialize(),null,2),z.innerHTML=JSON.stringify(this.serializeTree(),null,2),console.log("Fired 2")}var v;(v=document.getElementById("add-item"))==null||v.addEventListener("click",()=>{u++;const r=y(`Item ${u}`,{index:u.toString()});S.addItem(r)});
