var T=Object.defineProperty;var L=(n,t,e)=>t in n?T(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>(L(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const M={listTag:"ul",listSelector:"ul",itemSelector:"li",handleSelector:".phl-handle",listClass:["phl-list"],activeClass:["phl-active"],dragClass:["phl-drag"],threshold:20,context:0,expandBtn:".phl-expand",collapseBtn:".phl-collapse",extractBtn:".phl-extract"},u=new Map;class C{constructor(t){c(this,"dragEl");c(this,"activeEl");c(this,"overEl");c(this,"from");c(this,"to");c(this,"lastMouseY");c(this,"lastStepX");c(this,"lastMove");c(this,"instances",[]);c(this,"movedFrom");this.lastMouseY=0,this.lastStepX=0,this.lastMove=0,this.instances.push(t)}register(t){this.instances.push(t)}dispatch(t){if(this.activeEl)for(let e=0;e<this.instances.length;e++){const s=this.instances[e];if(!s.getElement().contains(this.activeEl))continue;const i=s.events.get(t);if(!i)return;i.forEach(o=>{o.call(s,{item:this.activeEl,from:this.from,to:this.to})});return}}}class a{constructor(t,e){c(this,"ctx");c(this,"element");c(this,"opts");c(this,"events",new Map);c(this,"hasTouch","ontouchstart"in window||navigator.maxTouchPoints);c(this,"onMouseMoveFn");c(this,"onTouchMoveFn");c(this,"cleanUpEvt");if(typeof t=="string"){if(this.element=l(t),!this.element)throw new Error("Provided element does not exist!")}else this.element=t;if(typeof this.element.__hierarchy_list_saad>"u")this.element.__hierarchy_list_saad=!0;else throw new Error("Trying to create multiple HierarchyList in one element!");this.opts={...M,...e||{}},["string","number"].indexOf(typeof this.opts.context)===-1&&(this.opts.context="_saad_");let s=u.get(this.opts.context);s?s.register(this):(s=new C(this),u.set(this.opts.context,s)),this.ctx=s,this.opts.listSelector||(this.opts.listSelector=this.opts.listTag),["listClass","activeClass","dragClass"].forEach(i=>{typeof this.opts[i]=="string"&&(this.opts[i]=this.opts[i].split(" "))}),this.init()}static make(t,e){return new a(t,e)}init(){this.onMouseMoveFn=t=>{this.onDrag(t)},this.onTouchMoveFn=t=>{this.onTouchMove(t)},this.cleanUpEvt=()=>{var t;(t=this.ctx.dragEl)==null||t.remove(),this.ctx.activeEl&&(F(this.ctx.activeEl,this.opts.activeClass),this.ctx.dispatch("release")),this.ctx.dragEl=void 0,this.ctx.activeEl=void 0,this.ctx.overEl=void 0,this.ctx.from=null,this.ctx.to=null,document.removeEventListener("mousemove",this.onMouseMoveFn),document.removeEventListener("mouseup",this.cleanUpEvt),document.removeEventListener("touchmove",this.onTouchMoveFn),document.removeEventListener("touchend",this.cleanUpEvt)},w(this.opts.handleSelector,this.element).forEach(t=>{this.initItem(t)}),this.element.addEventListener("mouseenter",()=>{if(!this.ctx.activeEl)return;if(this.element.matches(this.opts.listSelector))this.element.appendChild(this.ctx.activeEl);else{const e=l(this.opts.listSelector,this.element);e&&this.moveTo(e)}if(this.ctx.movedFrom){const e=this.ctx.movedFrom.events.get("moveout");e&&e.forEach(s=>{s.call(this.ctx.movedFrom,{item:this.ctx.activeEl})}),this.ctx.movedFrom=void 0}const t=this.events.get("movein");t&&t.forEach(e=>{e.call(this,{item:this.ctx.activeEl})})}),this.element.addEventListener("mouseleave",()=>{this.ctx.activeEl&&(this.ctx.movedFrom=this)})}initItem(t){const e=i=>{if(i.cancelable)i.preventDefault();else return;i.stopPropagation(),this.ctx.dragEl=s.cloneNode(!0),p(this.ctx.dragEl,this.opts.dragClass),document.body.appendChild(this.ctx.dragEl),this.ctx.dragEl.style.position="fixed",this.ctx.dragEl.style.pointerEvents="none",this.ctx.activeEl=s,p(this.ctx.activeEl,this.opts.activeClass),document.addEventListener("mousemove",this.onMouseMoveFn),document.addEventListener("mouseup",this.cleanUpEvt),this.hasTouch&&(document.addEventListener("touchmove",this.onTouchMoveFn),document.addEventListener("touchend",this.cleanUpEvt));let o,r;"x"in i&&"y"in i?(o=i.x,r=i.y):(o=i.touches[0].clientX,r=i.touches[0].clientY),this.ctx.lastMouseY=r,this.ctx.lastStepX=o,this.ctx.dragEl.style.left=o+"px",this.ctx.dragEl.style.top=r+"px",this.ctx.from=this.ctx.activeEl.parentElement,this.ctx.to=null,this.ctx.dispatch("start")},s=t.closest(this.opts.itemSelector);s&&(t.addEventListener("mousedown",e),this.hasTouch&&t.addEventListener("touchstart",i=>{i.touches.length===1&&e(i)}),s.addEventListener("mouseenter",()=>this.onOver(s)),this.btnEvts(s))}btnEvts(t){const e=l(this.opts.expandBtn,t),s=l(this.opts.collapseBtn,t),i=l(this.opts.extractBtn,t),o=l(this.opts.listSelector,t),r=o?getComputedStyle(o):{};e&&(r.display==="none"?e.style.display="":e.style.display="none",e.addEventListener("click",()=>{this.expand(e.closest(this.opts.itemSelector))})),s&&(r.display==="none"||!o?s.style.display="none":s.style.display="",s.addEventListener("click",()=>{this.collapse(s.closest(this.opts.itemSelector))})),i&&(!o||o.children.length===0?(o==null||o.remove(),i.style.display="none"):i.style.display="",i.addEventListener("click",()=>{this.extract(i.closest(this.opts.itemSelector))}))}onOver(t){if(this.ctx.activeEl){if(this.ctx.activeEl.contains(t)){this.ctx.overEl=void 0;return}this.ctx.overEl=t}}onTouchMove(t){const e=t.touches[0],s=document.elementFromPoint(e.clientX,e.clientY),i=s==null?void 0:s.closest(this.opts.itemSelector);i&&this.element.contains(i)&&this.onOver(i),this.onDrag({x:e.clientX,y:e.clientY})}onDrag(t){const e=this.ctx.dragEl;if(e.style.left=t.x+"px",e.style.top=t.y+"px",Date.now()-this.ctx.lastMove<100)return;this.ctx.lastMove=Date.now();const s=this.ctx.lastMouseY;this.ctx.lastMouseY=t.y;const i=this.ctx.lastStepX;if(t.x-i>this.opts.threshold)this.toRight(),this.ctx.lastStepX=t.x;else if(i-t.x>this.opts.threshold){this.toLeft(),this.ctx.lastStepX=t.x;return}const o=this.ctx.overEl;if(!o)return;const r=o.getBoundingClientRect();s<t.y?t.y>r.top&&this.moveTo(o.parentElement,o.nextElementSibling):t.y<r.top+r.height&&this.moveTo(o.parentElement,o)}toRight(){var o;const t=this.ctx.activeEl,e=(o=this.ctx.activeEl)==null?void 0:o.previousElementSibling;if(!t||!e)return;let s=l(this.opts.listSelector,e);s||(s=document.createElement(this.opts.listTag),p(s,this.opts.listClass),e.appendChild(s)),this.moveTo(s),this.expand(e);const i=l(this.opts.extractBtn,e);i&&(i.style.display=""),this.ctx.dispatch("rightmove")}toLeft(){var s;const t=(s=this.ctx.activeEl)==null?void 0:s.parentElement,e=t==null?void 0:t.closest(this.opts.itemSelector);e&&(this.moveTo(e.parentElement,e.nextElementSibling),this.ctx.dispatch("leftmove"))}moveTo(t,e=null){var o;if(!this.ctx.activeEl)return;const s=(o=this.ctx.activeEl)==null?void 0:o.closest(this.opts.listSelector),i=s==null?void 0:s.closest(this.opts.itemSelector);this.ctx.from=this.ctx.activeEl.parentElement,this.ctx.to=t,this.ctx.dispatch("beforemove"),t.insertBefore(this.ctx.activeEl,e),s&&s.children.length===0&&(s.remove(),i&&this.hideAllActions(i)),this.ctx.dispatch("aftermove")}expand(t){const e=l(this.opts.expandBtn,t),s=l(this.opts.collapseBtn,t);e&&(e.style.display="none");const i=l(this.opts.listSelector,t);i&&(i.style.display="",s&&(s.style.display=""))}collapse(t){const e=l(this.opts.expandBtn,t),s=l(this.opts.collapseBtn,t);s&&(s.style.display="none");const i=l(this.opts.listSelector,t);i&&(i.style.display="none",e&&(e.style.display=""))}extract(t){const e=l(this.opts.listSelector,t),s=t.parentElement;if(!e||!s)return;this.ctx.from=e,this.ctx.to=s;const i=t.nextElementSibling;for(;e.children.length;)s.insertBefore(e.children[0],i);e.remove(),this.hideAllActions(t),this.ctx.dispatch("extract"),this.ctx.from=null,this.ctx.to=null}hideAllActions(t){const e=l(this.opts.extractBtn,t),s=l(this.opts.expandBtn,t),i=l(this.opts.collapseBtn,t);s&&(s.style.display="none"),i&&(i.style.display="none"),e&&(e.style.display="none")}on(t,e){return typeof t=="string"&&(t=[t]),t.forEach(s=>{if(s==="change"){this.on(["release","moveout","extract","movein"],e);return}let i=this.events.get(s);i||(i=[],this.events.set(s,i)),i.indexOf(e)===-1&&i.push(e)}),this}serialize(){return a.serialize(this.element,this.opts.listSelector)}serializeTree(){return a.serializeTree(this.element,this.opts.listSelector)}static serialize(t,e="ul,ol"){if(t&&!t.matches(e)&&(t=l(e,t)),!t)throw new Error("No element is given to serialize!");const s=[];return this._serializeFlat(t,-1,s,e),s}static _serializeFlat(t,e,s,i){for(let o=0;o<t.children.length;o++){const r=t.children[o],d={data:r.dataset,parent:e};s.push(d);const f=l(i,r);f&&this._serializeFlat(f,s.length-1,s,i)}}static serializeTree(t,e="ol,ul"){if(t&&!t.matches(e)&&(t=l(e,t)),!t)throw new Error("No element is given to serialize!");const s=[];return this._serializeTree(t,s,e),s}static _serializeTree(t,e,s){for(let i=0;i<t.children.length;i++){const o=t.children[i],r=[],d=l("ul,li",o);d&&this._serializeTree(d,r,s),e.push({data:o.dataset,children:r})}}getElement(){return this.element}addItem(t,e){var s,i;if(!t.matches(this.opts.itemSelector)){console.error(`[HierarchyList] provided item does not match: ${this.opts.itemSelector}`);return}if(this.initItem(t),!e){let o=this.element;o.matches(this.opts.listSelector)||(o=l(this.opts.listSelector,o)),o&&o.appendChild(t);return}if(typeof e.before=="string"&&(e.before=l(e.before,this.element)),e.before){(s=e.before.parentElement)==null||s.insertBefore(t,e.before);return}if(typeof e.after=="string"&&(e.after=l(e.after,this.element)),e.after){(i=e.after.parentElement)==null||i.insertBefore(t,e.after.nextElementSibling);return}if(typeof e.inside=="string"&&(e.inside=l(e.inside,this.element)),e.inside){if(e.inside.matches(this.opts.listSelector)){e.inside.appendChild(t);return}let o=l(this.opts.listSelector,e.inside);o||(o=document.createElement(this.opts.listTag),p(o,this.opts.listClass),e.inside.appendChild(o)),o.appendChild(t),this.expand(o);const r=l(this.opts.extractBtn,o);r&&(r.style.display="")}console.warn("[HierarchyList] No target found to insert at: ",e)}}function l(n,t){return(t||document).querySelector(n)}function w(n,t){return(t||document).querySelectorAll(n)}function F(n,t){t.forEach(e=>n.classList.remove(e))}function p(n,t){t.forEach(e=>n.classList.add(e))}window&&typeof window.HierarchyList>"u"&&(window.HierarchyList=a);const v=document.querySelector("#app1"),b=document.querySelector("#flat-1"),B=document.querySelector("#tree-1"),E=document.querySelector("#app2"),O=document.querySelector("#flat-2"),z=document.querySelector("#tree-2"),N=document.querySelector("template"),y=N.content.querySelector(".phl-item");let h=0;for(let n=0;n<10;n++){const t=y.cloneNode(!0);t.querySelector(".phl-label").innerHTML=`Item ${n+1}`,t.setAttribute("data-index",n.toString()),t.dataset.index2=n.toString(),t.dataset.index3=n.toString(),v.appendChild(t),E.appendChild(t.cloneNode(!0)),h=n}const g=a.make(v).on("change",S);S.call(g);m.call(a.make(E).on("change",m));function S(){b.innerHTML=JSON.stringify(this.serialize(),null,2),B.innerHTML=JSON.stringify(this.serializeTree(),null,2),console.log("Fired 1")}function m(){O.innerHTML=JSON.stringify(this.serialize(),null,2),z.innerHTML=JSON.stringify(this.serializeTree(),null,2),console.log("Fired 2")}var x;(x=document.getElementById("add-item"))==null||x.addEventListener("click",()=>{h++;const n=y.cloneNode(!0);n.querySelector(".phl-label").innerHTML=`Item ${h+1}`,n.setAttribute("data-index",h.toString()),n.dataset.index2=h.toString(),n.dataset.index3=h.toString(),g.addItem(n)});
