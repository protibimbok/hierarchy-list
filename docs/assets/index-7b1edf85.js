var E=Object.defineProperty;var g=(l,t,e)=>t in l?E(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var a=(l,t,e)=>(g(l,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const S={listTag:"ul",listSelector:"ul",itemSelector:"li",handleSelector:".phl-handle",listClass:["phl-list"],activeClass:["phl-active"],dragClass:["phl-drag"],threshold:20,context:0,expandBtn:".phl-expand",collapseBtn:".phl-collapse",extractBtn:".phl-extract"},x=new Map;class T{constructor(t){a(this,"dragEl");a(this,"activeEl");a(this,"overEl");a(this,"from");a(this,"to");a(this,"lastMouseY");a(this,"lastStepX");a(this,"lastMove");a(this,"instances",[]);this.lastMouseY=0,this.lastStepX=0,this.lastMove=0,this.instances.push(t)}register(t){this.instances.push(t)}dispatch(t){if(this.activeEl)for(let e=0;e<this.instances.length;e++){const i=this.instances[e];if(!i.element.contains(this.activeEl))continue;const s=i.events.get(t);if(!s)return;s.forEach(o=>{o.call(i,{item:this.activeEl,from:this.from,to:this.to})});return}}}class d{constructor(t,e){a(this,"ctx");a(this,"element");a(this,"opts");a(this,"events",new Map);a(this,"hasTouch","ontouchstart"in window||navigator.maxTouchPoints);if(typeof t=="string"){if(this.element=c(t),!this.element)throw new Error("Provided element does not exist!")}else this.element=t;if(typeof this.element.__hierarchy_list_saad>"u")this.element.__hierarchy_list_saad=!0;else throw new Error("Trying to create multiple HierarchyList in one element!");this.opts={...S,...e||{}},["string","number"].indexOf(typeof this.opts.context)===-1&&(this.opts.context="_saad_");let i=x.get(this.opts.context);i?i.register(this):(i=new T(this),x.set(this.opts.context,i)),this.ctx=i,this.opts.listSelector||(this.opts.listSelector=this.opts.listTag),["listClass","activeClass","dragClass"].forEach(s=>{typeof this.opts[s]=="string"&&(this.opts[s]=this.opts[s].split(" "))}),this.init()}static make(t,e){return new d(t,e)}init(){const t=s=>{this.onDrag(s)},e=s=>{this.onTouchMove(s)},i=()=>{var s;(s=this.ctx.dragEl)==null||s.remove(),this.ctx.activeEl&&(w(this.ctx.activeEl,this.opts.activeClass),this.ctx.dispatch("release")),this.ctx.dragEl=void 0,this.ctx.activeEl=void 0,this.ctx.overEl=void 0,this.ctx.from=null,this.ctx.to=null,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",i),document.removeEventListener("touchmove",e),document.removeEventListener("touchend",i)};L(this.opts.handleSelector,this.element).forEach(s=>{this.initItem(s,{onMouseMoveFn:t,cleanUpEvt:i,onTouchMoveFn:e})}),this.element.addEventListener("mouseenter",()=>{if(!this.ctx.activeEl)return;if(this.element.matches(this.opts.listSelector)){this.element.appendChild(this.ctx.activeEl);return}const s=c(this.opts.listSelector,this.element);s&&this.moveTo(s)}),this.element.addEventListener("mouseleave",()=>{const s=this.events.get("moveout");!this.ctx.activeEl||!s||s.forEach(o=>{o.call(this,{item:this.ctx.activeEl})})})}initItem(t,{onMouseMoveFn:e,cleanUpEvt:i,onTouchMoveFn:s}){const o=r=>{if(r.cancelable)r.preventDefault();else return;r.stopPropagation(),this.ctx.dragEl=n.cloneNode(!0),u(this.ctx.dragEl,this.opts.dragClass),document.body.appendChild(this.ctx.dragEl),this.ctx.dragEl.style.position="fixed",this.ctx.dragEl.style.pointerEvents="none",this.ctx.activeEl=n,u(this.ctx.activeEl,this.opts.activeClass),document.addEventListener("mousemove",e),document.addEventListener("mouseup",i),this.hasTouch&&(document.addEventListener("touchmove",s),document.addEventListener("touchend",i));let h,p;"x"in r&&"y"in r?(h=r.x,p=r.y):(h=r.touches[0].clientX,p=r.touches[0].clientY),this.ctx.lastMouseY=p,this.ctx.lastStepX=h,this.ctx.dragEl.style.left=h+"px",this.ctx.dragEl.style.top=p+"px",this.ctx.from=this.ctx.activeEl.parentElement,this.ctx.to=null,this.ctx.dispatch("start")},n=t.closest(this.opts.itemSelector);n&&(t.addEventListener("mousedown",o),this.hasTouch&&t.addEventListener("touchstart",r=>{r.touches.length===1&&o(r)}),n.addEventListener("mouseenter",()=>this.onOver(n)),this.btnEvts(n))}btnEvts(t){const e=c(this.opts.expandBtn,t),i=c(this.opts.collapseBtn,t),s=c(this.opts.extractBtn,t),o=c(this.opts.listSelector,t),n=o?getComputedStyle(o):{};e&&(n.display==="none"?e.style.display="":e.style.display="none",e.addEventListener("click",()=>{this.expand(e.closest(this.opts.itemSelector))})),i&&(n.display==="none"||!o?i.style.display="none":i.style.display="",i.addEventListener("click",()=>{this.collapse(i.closest(this.opts.itemSelector))})),s&&(!o||o.children.length===0?(o==null||o.remove(),s.style.display="none"):s.style.display="",s.addEventListener("click",()=>{this.extract(s.closest(this.opts.itemSelector))}))}onOver(t){if(this.ctx.activeEl){if(this.ctx.activeEl.contains(t)){this.ctx.overEl=void 0;return}this.ctx.overEl=t}}onTouchMove(t){const e=t.touches[0],i=document.elementFromPoint(e.clientX,e.clientY),s=i==null?void 0:i.closest(this.opts.itemSelector);s&&this.element.contains(s)&&this.onOver(s),this.onDrag({x:e.clientX,y:e.clientY})}onDrag(t){const e=this.ctx.dragEl;if(e.style.left=t.x+"px",e.style.top=t.y+"px",Date.now()-this.ctx.lastMove<100)return;this.ctx.lastMove=Date.now();const i=this.ctx.lastMouseY;this.ctx.lastMouseY=t.y;const s=this.ctx.lastStepX;if(t.x-s>this.opts.threshold)this.toRight(),this.ctx.lastStepX=t.x;else if(s-t.x>this.opts.threshold){this.toLeft(),this.ctx.lastStepX=t.x;return}const o=this.ctx.overEl;if(!o)return;const n=o.getBoundingClientRect();i<t.y?t.y>n.top&&this.moveTo(o.parentElement,o.nextElementSibling):t.y<n.top+n.height&&this.moveTo(o.parentElement,o)}toRight(){var o;const t=this.ctx.activeEl,e=(o=this.ctx.activeEl)==null?void 0:o.previousElementSibling;if(!t||!e)return;let i=c(this.opts.listSelector,e);i||(i=document.createElement(this.opts.listTag),u(i,this.opts.listClass),e.appendChild(i)),this.moveTo(i),this.expand(e);const s=c(this.opts.extractBtn,e);s&&(s.style.display=""),this.ctx.dispatch("rightmove")}toLeft(){var i;const t=(i=this.ctx.activeEl)==null?void 0:i.parentElement,e=t==null?void 0:t.closest(this.opts.itemSelector);e&&(this.moveTo(e.parentElement,e.nextElementSibling),this.ctx.dispatch("leftmove"))}moveTo(t,e=null){var o;if(!this.ctx.activeEl)return;const i=(o=this.ctx.activeEl)==null?void 0:o.closest(this.opts.listSelector),s=i==null?void 0:i.closest(this.opts.itemSelector);this.ctx.from=this.ctx.activeEl.parentElement,this.ctx.to=t,this.ctx.dispatch("beforemove"),t.insertBefore(this.ctx.activeEl,e),i&&i.children.length===0&&(i.remove(),s&&this.hideAllActions(s)),this.ctx.dispatch("aftermove")}expand(t){const e=c(this.opts.expandBtn,t),i=c(this.opts.collapseBtn,t);e&&(e.style.display="none");const s=c(this.opts.listSelector,t);if(!s){console.log("Here",t);return}s.style.display="",i&&(i.style.display="")}collapse(t){const e=c(this.opts.expandBtn,t),i=c(this.opts.collapseBtn,t);i&&(i.style.display="none");const s=c(this.opts.listSelector,t);s&&(s.style.display="none",e&&(e.style.display=""))}extract(t){var s;const e=c(this.opts.listSelector,t);if(!e||!parent)return;const i=t.nextElementSibling;for(;e.children.length;)(s=t.parentElement)==null||s.insertBefore(e.children[0],i);e.remove(),this.hideAllActions(t)}hideAllActions(t){const e=c(this.opts.extractBtn,t),i=c(this.opts.expandBtn,t),s=c(this.opts.collapseBtn,t);i&&(i.style.display="none"),s&&(s.style.display="none"),e&&(e.style.display="none")}on(t,e){let i=this.events.get(t);return i||(i=[],this.events.set(t,i)),i.push(e),this}serialize(){return d.serialize(this.element,this.opts.listSelector)}serializeTree(){return d.serializeTree(this.element,this.opts.listSelector)}static serialize(t,e="ul,ol"){if(t&&!t.matches(e)&&(t=c(e,t)),!t)throw new Error("No element is given to serialize!");const i=[];return this._serializeFlat(t,-1,i,e),i}static _serializeFlat(t,e,i,s){for(let o=0;o<t.children.length;o++){const n=t.children[o],r={data:n.dataset,parent:e};i.push(r);const h=c(s,n);h&&this._serializeFlat(h,i.length-1,i,s)}}static serializeTree(t,e="ol,ul"){if(t&&!t.matches(e)&&(t=c(e,t)),!t)throw new Error("No element is given to serialize!");const i=[];return this._serializeTree(t,i,e),i}static _serializeTree(t,e,i){for(let s=0;s<t.children.length;s++){const o=t.children[s],n=[],r=c("ul,li",o);r&&this._serializeTree(r,n,i),e.push({data:o.dataset,children:n})}}}function c(l,t){return(t||document).querySelector(l)}function L(l,t){return(t||document).querySelectorAll(l)}function w(l,t){t.forEach(e=>l.classList.remove(e))}function u(l,t){t.forEach(e=>l.classList.add(e))}window&&typeof window.HierarchyList>"u"&&(window.HierarchyList=d);const v=document.querySelector("#app1"),M=document.querySelector("#flat-1"),C=document.querySelector("#tree-1"),y=document.querySelector("#app2"),z=document.querySelector("#flat-2"),O=document.querySelector("#tree-2"),b=document.querySelector("template"),B=b.content.querySelector(".phl-item");for(let l=0;l<10;l++){const t=B.cloneNode(!0);t.querySelector(".phl-label").innerHTML=`Item ${l+1}`,t.setAttribute("data-index",l.toString()),t.dataset.index2=l.toString(),t.dataset.index3=l.toString(),v.appendChild(t),y.appendChild(t.cloneNode(!0))}f.call(d.make(v).on("release",f).on("moveout",f));m.call(d.make(y).on("release",m).on("moveout",m));function f(){M.innerHTML=JSON.stringify(this.serialize(),null,2),C.innerHTML=JSON.stringify(this.serializeTree(),null,2)}function m(){z.innerHTML=JSON.stringify(this.serialize(),null,2),O.innerHTML=JSON.stringify(this.serializeTree(),null,2)}
